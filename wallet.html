<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Sale & Airdrop</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script type="module">
        import { EthereumProvider } from "https://esm.sh/@walletconnect/ethereum-provider@2.8.1";
        import { ethers } from "https://esm.sh/ethers";

        let provider, signer, contract;
        const contractAddress = "0x857C588260DDD9934F40c90BC41a1FA4Da2e8b31"; // Ganti dengan alamat smart contract
        const abi = [{"constant":false,"inputs":[{"name":"_refer","type":"address"}],"name":"getAirdrop","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"tokens","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"aSBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_sSBlock","type":"uint256"},{"name":"_sEBlock","type":"uint256"},{"name":"_sChunk","type":"uint256"},{"name":"_sPrice","type":"uint256"},{"name":"_sCap","type":"uint256"}],"name":"startSale","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"from","type":"address"},{"name":"to","type":"address"},{"name":"tokens","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"sPrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"viewSale","outputs":[{"name":"StartBlock","type":"uint256"},{"name":"EndBlock","type":"uint256"},{"name":"SaleCap","type":"uint256"},{"name":"SaleCount","type":"uint256"},{"name":"ChunkSize","type":"uint256"},{"name":"SalePrice","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"aTot","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"clearETH","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_refer","type":"address"}],"name":"tokenSale","outputs":[{"name":"success","type":"bool"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"tokenOwner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_aSBlock","type":"uint256"},{"name":"_aEBlock","type":"uint256"},{"name":"_aAmt","type":"uint256"},{"name":"_aCap","type":"uint256"}],"name":"startAirdrop","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"acceptOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"sTot","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"sSBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"sChunk","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"aEBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"tokens","type":"uint256"}],"name":"transfer","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"sCap","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"aCap","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"tokens","type":"uint256"},{"name":"data","type":"bytes"}],"name":"approveAndCall","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"sEBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"newOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"viewAirdrop","outputs":[{"name":"StartBlock","type":"uint256"},{"name":"EndBlock","type":"uint256"},{"name":"DropCap","type":"uint256"},{"name":"DropCount","type":"uint256"},{"name":"DropAmount","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"tokenOwner","type":"address"},{"name":"spender","type":"address"}],"name":"allowance","outputs":[{"name":"remaining","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"aAmt","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"tokens","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"tokenOwner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"tokens","type":"uint256"}],"name":"Approval","type":"event"}];

        async function connectWallet() {
            try {
                console.log("üîµ Menghubungkan Wallet...");
                provider = await EthereumProvider.init({
                    projectId: "2891d08b2b53e94b9c8ec031af88d6a9",
                    showQrModal: true,
                    chains: [56], // Binance Smart Chain (BSC)
                    rpcMap: { 56: "https://bsc-dataseed1.binance.org/" }
                });

                await provider.connect();
                console.log("‚úÖ Wallet Terhubung.");

                signer = new ethers.BrowserProvider(provider).getSigner();
                contract = new ethers.Contract(contractAddress, abi, signer);

                const accounts = provider.accounts;
                document.getElementById("walletAddress").innerText = `üîó Wallet: ${accounts[0]}`;

                document.getElementById("connectBtn").disabled = true;
                document.getElementById("disconnectBtn").disabled = false;
            } catch (error) {
                console.error("‚ùå Error:", error);
                alert("Gagal menghubungkan wallet.");
            }
        }

        function disconnectWallet() {
            if (provider) {
                provider.disconnect();
                document.getElementById("walletAddress").innerText = "üîó Wallet: Not Connected";
                document.getElementById("connectBtn").disabled = false;
                document.getElementById("disconnectBtn").disabled = true;
                console.log("üî¥ Wallet Terputus.");
            }
        }

        function getReferralAddress() {
            const referralInput = document.getElementById("referralAddress").value.trim();
            return ethers.isAddress(referralInput) ? referralInput : "0x0000000000000000000000000000000000000000";
        }

        async function getAirdrop() {
            if (!signer || !contract) {
                alert("Silakan hubungkan wallet terlebih dahulu!");
                return;
            }

            try {
                const referral = getReferralAddress();
                const tx = await contract.getAirdrop(referral);
                await tx.wait();
                console.log("‚úÖ Airdrop berhasil diklaim:", tx.hash);
                alert(`Airdrop berhasil diklaim! TX Hash: ${tx.hash}`);
            } catch (error) {
                console.error("‚ùå Gagal klaim airdrop:", error);
                alert("Gagal klaim airdrop! Cek console.");
            }
        }

        async function buyToken() {
            if (!signer || !contract) {
                alert("Silakan hubungkan wallet terlebih dahulu!");
                return;
            }

            try {
                const referral = getReferralAddress();
                const amount = ethers.parseEther(document.getElementById("bnbAmount").value || "0"); 
                if (amount <= 0) {
                    alert("Masukkan jumlah BNB yang valid!");
                    return;
                }

                const tx = await contract.tokenSale(referral, { value: amount });
                await tx.wait();
                console.log("‚úÖ Token berhasil dibeli:", tx.hash);
                alert(`Pembelian token berhasil! TX Hash: ${tx.hash}`);
            } catch (error) {
                console.error("‚ùå Gagal membeli token:", error);
                alert("Gagal membeli token! Cek console.");
            }
        }

        function getReferrerFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const referrer = urlParams.get("ref");
            if (ethers.isAddress(referrer)) {
                document.getElementById("referralAddress").value = referrer;
            }
        }

        window.connectWallet = connectWallet;
        window.disconnectWallet = disconnectWallet;
        window.getAirdrop = getAirdrop;
        window.buyToken = buyToken;
        window.onload = getReferrerFromURL;
    </script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        .container { max-width: 400px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 10px; box-shadow: 0px 0px 10px #aaa; }
        button { padding: 10px; margin: 5px; cursor: pointer; }
        #connectBtn { background-color: green; color: white; }
        #disconnectBtn { background-color: red; color: white; }
    </style>
</head>
<body>

    <div class="container">
        <h2>üöÄ Token Sale & Airdrop</h2>
        <button id="connectBtn" onclick="connectWallet()">üü¢ Connect Wallet</button>
        <button id="disconnectBtn" onclick="disconnectWallet()" disabled>‚ùå Disconnect</button>
        <p id="walletAddress">üîó Wallet: Not Connected</p>

        <h3>üéÅ Claim Airdrop</h3>
        <input type="text" id="referralAddress" placeholder="Enter Referral Address (Optional)">
        <button onclick="getAirdrop()">üöÄ Claim Airdrop</button>

        <h3>üí∞ Buy Token</h3>
        <input type="text" id="bnbAmount" placeholder="Enter BNB Amount">
        <button onclick="buyToken()">ü™ô Buy Token</button>
    </div>

</body>
</html>
