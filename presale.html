<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presale Token</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.5/web3.min.js"></script>
    <style>
        body {
            background-color: black;
            color: gold;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .container {
            width: 90%;
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            border: 2px solid gold;
            border-radius: 10px;
            background: #222;
        }
        .countdown {
            font-size: 24px;
            margin: 10px 0;
        }
        .button {
            background: gold;
            color: black;
            padding: 10px;
            margin: 10px;
            width: 80%;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .button:hover {
            background: #ffcc00;
        }
        input {
            width: 90%;
            padding: 8px;
            margin: 5px;
            border-radius: 5px;
            border: 1px solid gold;
            background: black;
            color: gold;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>Presale Token</h2>
        <div class="countdown" id="countdown">00:00:00</div>
        <p>BNB Balance: <span id="bnbBalance">0</span></p>
        <p>Token Price: <span id="tokenPrice">-</span> BNB</p>
        <p>Tokens Sold: <span id="tokensSold">0</span></p>

        <button class="button" onclick="connectWallet()">Connect Wallet</button>
        <p>Wallet: <span id="walletAddress">Not Connected</span></p>

        <input type="number" id="buyAmount" placeholder="Enter BNB Amount">
        <button class="button" onclick="buyTokens()">Buy Tokens</button>

        <button class="button" onclick="claimAirdrop()">Claim Airdrop</button>
    </div>

    <script>
        const contractAddress = "0x857C588260DDD9934F40c90BC41a1FA4Da2e8b31";  // Ganti dengan alamat kontrak token kamu
        const abi =[{"constant":false,"inputs":[{"name":"_refer","type":"address"}],"name":"getAirdrop","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"tokens","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"aSBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_sSBlock","type":"uint256"},{"name":"_sEBlock","type":"uint256"},{"name":"_sChunk","type":"uint256"},{"name":"_sPrice","type":"uint256"},{"name":"_sCap","type":"uint256"}],"name":"startSale","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"from","type":"address"},{"name":"to","type":"address"},{"name":"tokens","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"sPrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"viewSale","outputs":[{"name":"StartBlock","type":"uint256"},{"name":"EndBlock","type":"uint256"},{"name":"SaleCap","type":"uint256"},{"name":"SaleCount","type":"uint256"},{"name":"ChunkSize","type":"uint256"},{"name":"SalePrice","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"aTot","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"clearETH","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_refer","type":"address"}],"name":"tokenSale","outputs":[{"name":"success","type":"bool"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"tokenOwner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_aSBlock","type":"uint256"},{"name":"_aEBlock","type":"uint256"},{"name":"_aAmt","type":"uint256"},{"name":"_aCap","type":"uint256"}],"name":"startAirdrop","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"acceptOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"sTot","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"sSBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"sChunk","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"aEBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"tokens","type":"uint256"}],"name":"transfer","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"sCap","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"aCap","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"tokens","type":"uint256"},{"name":"data","type":"bytes"}],"name":"approveAndCall","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"sEBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"newOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"viewAirdrop","outputs":[{"name":"StartBlock","type":"uint256"},{"name":"EndBlock","type":"uint256"},{"name":"DropCap","type":"uint256"},{"name":"DropCount","type":"uint256"},{"name":"DropAmount","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"tokenOwner","type":"address"},{"name":"spender","type":"address"}],"name":"allowance","outputs":[{"name":"remaining","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"aAmt","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"tokens","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"tokenOwner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"tokens","type":"uint256"}],"name":"Approval","type":"event"}]; // Ganti dengan ABI yang kamu berikan tadi

        let web3;
        let contract;
        let userAccount;

        async function connectWallet() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    const accounts = await ethereum.request({ method: "eth_requestAccounts" });
                    userAccount = accounts[0];
                    document.getElementById("walletAddress").innerText = userAccount;
                    contract = new web3.eth.Contract(abi, contractAddress);
                    getUserData();
                } catch (error) {
                    alert("Wallet connection failed!");
                }
            } else {
                alert("Metamask not found!");
            }
        }

        async function getUserData() {
            if (!contract) return;
            try {
                let balance = await web3.eth.getBalance(userAccount);
                document.getElementById("bnbBalance").innerText = web3.utils.fromWei(balance, "ether");

                let saleInfo = await contract.methods.viewSale().call();
                document.getElementById("tokenPrice").innerText = web3.utils.fromWei(saleInfo.SalePrice, "ether");
                document.getElementById("tokensSold").innerText = saleInfo.SaleCount;

                startCountdown(saleInfo.EndBlock);
            } catch (error) {
                console.error(error);
            }
        }

        async function buyTokens() {
            if (!contract || !userAccount) return alert("Connect wallet first!");
            let amount = document.getElementById("buyAmount").value;
            if (amount <= 0) return alert("Enter a valid amount!");

            try {
                let price = await contract.methods.sPrice().call();
                let totalCost = web3.utils.toWei((amount * price).toString(), "ether");

                await contract.methods.tokenSale(userAccount).send({ from: userAccount, value: totalCost });
                alert("Tokens purchased successfully!");
                getUserData();
            } catch (error) {
                console.error(error);
                alert("Transaction failed!");
            }
        }

        async function claimAirdrop() {
            if (!contract || !userAccount) return alert("Connect wallet first!");
            try {
                await contract.methods.getAirdrop(userAccount).send({ from: userAccount });
                alert("Airdrop claimed!");
                getUserData();
            } catch (error) {
                console.error(error);
                alert("Failed to claim airdrop!");
            }
        }

        function startCountdown(endBlock) {
            let countdownEl = document.getElementById("countdown");
            let interval = setInterval(async () => {
                let currentBlock = await web3.eth.getBlockNumber();
                let remainingBlocks = endBlock - currentBlock;
                let remainingTime = remainingBlocks * 3; // Rata-rata 3 detik per block

                if (remainingTime <= 0) {
                    clearInterval(interval);
                    countdownEl.innerText = "Presale Ended";
                } else {
                    let hours = Math.floor(remainingTime / 3600);
                    let minutes = Math.floor((remainingTime % 3600) / 60);
                    let seconds = remainingTime % 60;
                    countdownEl.innerText = `${hours}h ${minutes}m ${seconds}s`;
                }
            }, 3000);
        }
    </script>

</body>
</html>
